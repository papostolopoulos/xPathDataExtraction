<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <title>xPath Generator</title>

    <style media="screen">

      *{
        box-sizing: border-box;
      }

      .sectionOptions{
        display: grid;
        grid-template-rows: 35vh 50vh 15vh;
        grid-template-columns: 60vw 40vw;
        grid-template-areas:
        "divBranch divElements"
        "divFunctions divElements"
        "divResult divResult"
      }

      .divBranch, .divFunctions{
        display: flex;
        flex-wrap: wrap;
      }

      .divBranch{
        flex-flow: column;
        grid-area: divBranch;
        background: lightgreen;
      }

      .divFunctions{
        align-content: flex-start;
      }

      .divBranch, .divFunctions, .divElements, .divResult{
        padding: 10px 20px;
      }

      h3, h4{
        margin: auto;
      }

      label{
        margin-right: 10px;
      }

      .divFunctions{
        grid-area: divFunctions;
        background: lightblue;
        display: flex;
        flex-flow: column;
        flex-wrap: wrap;
      }

      .divElements{
        grid-area: divElements;
        background: lightyellow;
      }

      .divResult{
        grid-area: divResult;
        background: lightgray;
      }

      .divBracketsOperators{
        display: grid;
        grid-template-columns: 30% 70%;
      }

      .divBracketsContainer, .divOperatorsContainer{
        text-align: center;
      }

      .divBrackets, .divOperators{
        text-align: justify;
      }

      .divFunctionInputs, .divFunctionAttribute, .divFunctionParams{
        display: flex;
        flex-direction: column;
      }

      .divFunctionInputs{
        width: 50%;
      }

      .functionInputs{
        display: flex;
        flex-flow: column wrap;
      }

      .divFunctionAttribute, .divFunctionParams{
        width: 25%;
      }

      .divParametersToggle{
        display: flex;
        flex-flow: column;
        /* justify-content: center; */
        /* height: 100%; */
        background: yellow;
      }

      .divParameters{
        display: flex;
        flex-flow: column;
      }



    </style>

  </head>







  <body>
    <main id="mainSlot">
      <section class="sectionOptions">
        <div class="divBranch">
          <h3>Branch</h3>
          <div class="divBranchInputs">
            <label>
              <input type="radio" value="//" name="axisOption" v-model="axis">
              //
            </label>
            <label>
              <input type="radio" value="/ancestor::" name="axisOption" v-model="axis">
              /ancestor::
            </label>
            <label>
              <input type="radio" value="/ancestor-or-self::" name="axisOption" v-model="axis">
              /ancestor-or-self::
            </label>
            <label>
              <input type="radio" value="/attribute::" name="axisOption" v-model="axis">
              /attribute::
            </label>
            <label>
              <input type="radio" value="/child::" name="axisOption" v-model="axis">
              /child::
            </label>
            <label>
              <input type="radio" value="/descendant::" name="axisOption" v-model="axis">
              /descendant::
            </label>
            <label>
              <input type="radio" value="/descendant-or-self::" name="axisOption" v-model="axis">
              /descendant-or-self::
            </label>
            <label>
              <input type="radio" value="/following::" name="axisOption" v-model="axis">
              /following::
            </label>
            <label>
              <input type="radio" value="/following-sibling::" name="axisOption" v-model="axis">
              /following-sibling::
            </label>
            <label>
              <input type="radio" value="/namespace::" name="axisOption" v-model="axis">
              /namespace::
            </label>
            <label>
              <input type="radio" value="/parent::" name="axisOption" v-model="axis">
              /parent::
            </label>
            <label>
              <input type="radio" value="/preceding::" name="axisOption" v-model="axis">
              /preceding::
            </label>
            <label>
              <input type="radio" value="/preceding-sibling::" name="axisOption" v-model="axis">
              /preceding-sibling::
            </label>
            <label>
              <input type="radio" value="/self::" name="axisOption" v-model="axis">
              /self::
            </label>

            <label>
              Node:
              <input type="text" name="addPathNode" v-model="node" @keyup.enter="addToPath($event)">
            </label>
          </div>


          <div class="divBracketsOperators">
            <div class="divBracketsContainer">
              <h3>Brackets</h3>
              <div class="divBrackets">
                <label>
                  <input type="radio" name="brackets" value="" v-model="brackets">
                  No
                </label>
                <label>
                  <input type="radio" name="brackets" value="[]" v-model="brackets" @click="addToPath($event)">
                  Brackets []
                </label>
              </div>
            </div>

            <div class="divOperatorsContainer">
              <h3>Operators</h3>
              <div class="divOperators">
                <label>
                  <input type="radio" name="inputOperator" value="" v-model="operator">
                  None
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="and" v-model="operator">
                  and
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="and not" v-model="operator">
                  and not()
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="not" v-model="operator">
                  not()
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="or" v-model="operator">
                  or
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="|" v-model="operator">
                  |
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="=" v-model="operator">
                  =
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="!=" v-model="operator">
                  !=
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="+" v-model="operator">
                  +
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="-" v-model="operator">
                  -
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="*" v-model="operator">
                  *
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="div" v-model="operator">
                  div
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="<" v-model="operator">
                  &lt;
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="<=" v-model="operator">
                  &lt;=
                </label>
                <label>
                  <input type="radio" name="inputOperator" value=">" v-model="operator">
                  &gt;
                </label>
                <label>
                  <input type="radio" name="inputOperator" value=">=" v-model="operator">
                  &gt;=
                </label>
                <label>
                  <input type="radio" name="inputOperator" value="mod" v-model="operator">
                  mod
                </label>
              </div>
            </div>


          </div>




        </div>

        <div class="divFunctions">
          <div class="divFunctionInputs">
            <h3>Function</h3>
            <div class="functionInputs">
              <label>
                <input type="radio" name="inputFunction" value="" v-model="inputFunction">
                None
              </label>
              <label>
                <input type="radio" name="inputFunction" value="count" v-model="inputFunction">
                count()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="concat" v-model="inputFunction">
                concat()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="contains" v-model="inputFunction">
                contains()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="element-available" v-model="inputFunction">
                element-available()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="false" v-model="inputFunction">
                false()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="floor" v-model="inputFunction">
                floor()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="function-available" v-model="inputFunction">
                function-available()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="lang" v-model="inputFunction">
                lang()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="last" v-model="inputFunction">
                last()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="local-name" v-model="inputFunction">
                local-name()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="name" v-model="inputFunction">
                name()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="namespace-url" v-model="inputFunction">
                namespace-url()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="normalize-space" v-model="inputFunction">
                normalize-space()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="not" v-model="inputFunction">
                not()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="number" v-model="inputFunction">
                number()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="position" v-model="inputFunction">
                position()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="round" v-model="inputFunction">
                round()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="starts-with" v-model="inputFunction">
                starts-with()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="string" v-model="inputFunction">
                string()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="string-length" v-model="inputFunction">
                string-length()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="substring" v-model="inputFunction">
                substring()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="substring-after" v-model="inputFunction">
                substring-after()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="substring-before" v-model="inputFunction">
                substring-before()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="sum" v-model="inputFunction">
                sum()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="translate" v-model="inputFunction">
                translate()
              </label>
              <label>
                <input type="radio" name="inputFunction" value="true" v-model="inputFunction">
                true()
              </label>
            </div>
          </div>

          <div class="divFunctionAttribute">
            <h3>Attribute</h3>
            <label>
              <input type="radio" name="attribute" value="@alt" v-model="attribute">
              @alt
            </label>
            <label>
              <input type="radio" name="attribute" value="@class" v-model="attribute">
              @class
            </label>
            <label>
              <input type="radio" name="attribute" value="@id" v-model="attribute">
              @id
            </label>
            <label>
              <input type="radio" name="attribute" value="@name" v-model="attribute">
              @name
            </label>
            <label>
              <input type="radio" name="attribute" v-model="attribute" value="@src" >
              @src
            </label>
            <label>
              <input type="radio" name="attribute" value="@title" v-model="attribute">
              @title
            </label>
            <label>
              <input type="radio" name="attribute" value="text()" v-model="attribute">
              text()
            </label>
            <label>
              <input type="radio" name="attribute" value="." v-model="attribute">
              .
            </label>
            <label>
              <input type="text" name="attribute" value="" v-model="attribute" @keyup.enter="addToPath($event)">
              Custom:
            </label>
          </div>

          <div class="divFunctionParams">
            <h3>Parameters</h3>

            <div class="divParametersToggle">
              <div class="divParameters" v-show="inputFunction === 'concat'">
                <h3>for concat()</h3>
              </div>
              <div class="divParameters" v-show="inputFunction === 'contains'">
                <h3>for contains()</h3>
                <label>
                  <input type="checkbox" name="translateString" v-model="translateString">
                  Translate the string
                </label>
                <label>
                  Add string
                  <input type="text" name="functionString" value="" v-model="functionString" @keyup.enter="addToPath($event)">
                </label>

              </div>
              <div class="divParameters" v-show="inputFunction === 'normalize-space'">
                <h3>for normalize-space()</h3>
              </div>
              <div class="divParameters" v-show="inputFunction === 'substring'">
                <h3>for substring()</h3>
              </div>
              <div class="divParameters" v-show="inputFunction === 'substring-after'">
                <h3>for substring-after()</h3>
              </div>
              <div class="divParameters" v-show="inputFunction === 'substring-before'">
                <h3>for substring-before()</h3>
              </div>
              <div class="divParameters" v-show="inputFunction === 'translate'">
                <h3>for translate()</h3>
              </div>

            </div>
          </div>
        </div>

        <div class="divElements">
          The elements will be displayed here <br>
          {{pathArray}}
        </div>

        <div class="divResult">
          Result displayed here: {{fullPath}}
        </div>

      </section>
      <!-- <p>Contents: {{pathArray}}</p>
      <p>fullPath: {{fullPath}}</p> -->


    </main>

  </body>









  <script>

    var app = new Vue({
      el: "#mainSlot",
      data: {
        axis:"/descendant::",
        node: "", //The node that is added after the axis
        brackets: "", // If new brackets are opening or not
        operator: "", //or, and, and not, not
        inputFunction: "",
        translateString: true,
        functionString: "",
        attribute: "",
        pathArray: [],

      }, //End of data
      methods:{
        addToPath(event){
          //Variable used to check on the last element of the pathArray. Needed for splicing
          let pathArrayLastElement = this.pathArray[this.pathArray.length-1];

          console.log("event.target.value:", event.target.value);
          console.log("event.target.name:", event.target.name);

          //Add an axis with the node name
          if (event.target.name === "addPathNode") {
            this.pathArray.push(this.axis + event.target.value);
            this.node = "";
          }

          //Add brackets
          if (event.target.name === "brackets" && event.target.value === "[]"){
            console.log(this.brackets);
            this.pathArray.push(event.target.value[0]);
            this.pathArray.push(event.target.value[1]);
          }

          //Add attribute by itself
          if (event.target.name === "attribute") {
            //If the last element of array is a bracket, then push the attribute as extension
            if (pathArrayLastElement[pathArrayLastElement.length-1] === "]") {
              this.pathArray.push("/" + event.target.name);
            }
          }

          //Add a function with all it's parameters
          if (event.target.name === "functionString") return this.addFunction();

        },


        addFunction(event){
          console.log("In add function");
          let pathArrayLastElement = this.pathArray[this.pathArray.length-1];
          let functionParams;

          //boolean function
          //ceiling function
          // choose function

          // concat function
          if(this.inputFunction === "concat"){

          }

          // contains function
          if (this.inputFunction === "contains" && pathArrayLastElement[pathArrayLastElement.length-1] === "]") {
            if(!this.translateString){ //If the translate option is not selected
              this.operator.includes("not") ?
              functionParams = `${this.operator} (${this.inputFunction}(${this.attribute}, '${this.functionString}')) ` :
              functionParams = `${this.operator} ${this.inputFunction}(${this.attribute}, '${this.functionString}') `;
            }
            else {
              let translateString = "";
              for (let i = 0; i < this.functionString.length; i++) {
                if(!translateString.includes(this.functionString[i].toLowerCase()) && /\w/.test(this.functionString[i]))
                translateString += this.functionString[i].toLowerCase();
              }

              this.operator.includes("not") ?
              functionParams = `${this.operator} (${this.inputFunction}(translate(${this.attribute}, '${translateString.toUpperCase()}', '${translateString}'), '${this.functionString.toLowerCase()}')) ` :
              functionParams = `${this.operator} ${this.inputFunction}(translate(${this.attribute}, '${translateString.toUpperCase()}', '${translateString}'), '${this.functionString.toLowerCase()}') `;
              console.log("TranslatedString:", translateString);
            }

            this.pathArray.splice(this.pathArray.length-1, 0, functionParams);
            return this.zeroProperties();
          }

          //count function
          //element-available function
          //false function
          //floor function
          //function available function
          //lang function
          //last function
          //local-name function
          // name function
          // namespace-url function
          //normalize-space function
          //not function
          //number function
          //position function
          //round function
          //starts-with function
          //string function
          //string-length function
          //substring function
          //substring-after function
          // substring-before function
          //sum function
          //translate function
          //true function

        },

        zeroProperties(){
          this.brackets = "";
          this.operator = "";
          this.inputFunction = "";
          this.translateString = true;
          this.attribute = "";
          this.functionString = "";
        }


      }, //End of methods
      computed: {
        fullPath(){
          return this.pathArray.join("");
        }
      } //end of computed properties
    });

  </script>

</html>
